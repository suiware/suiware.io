---
import qrcode from "qrcode"
import Layout from "@/layouts/Layout.astro"
import Header from "@/components/Header.astro"
import Footer from "@/components/Footer.astro"
import { DONATION_ADDRESS, SITE } from "@/config"

const qrSvg = await qrcode.toString(DONATION_ADDRESS, {
  type: "svg",
  margin: 2,
  width: 240,
  color: { dark: "#000000", light: "#ffffff" },
})
---

<Layout title={`Donate | ${SITE.title}`} description="Support Suiware by donating SUI directly to our wallet." robots="noindex, nofollow">
  <Header />

  <main id="main-content" class="mx-auto flex max-w-3xl flex-1 flex-col items-center justify-center px-4 py-16">
    <h1 class="text-2xl font-bold text-accent sm:text-3xl">Support our work</h1>
    <p class="mt-3 mb-10 max-w-sm text-center text-sm opacity-75">
      Donations go directly to our Sui wallet - no intermediaries.
    </p>

    <div class="rounded-xl border border-border bg-background p-4 shadow-sm dark:bg-border/20">
      <Fragment set:html={qrSvg} />
    </div>

    <p class="mt-8 text-sm font-medium">SUI address</p>
    <div class="mt-2 flex flex-col items-center gap-2">
      <code
        id="donation-address"
        class="break-all rounded border border-border bg-border/40 px-3 py-2 text-xs dark:bg-border/20 sm:text-sm"
      >
        {DONATION_ADDRESS}
      </code>
      <button
        id="copy-address"
        aria-label="Copy address"
        class="focus-outline rounded border border-border px-3 py-2 text-xs hover:opacity-75"
      >
        Copy
      </button>
    </div>
  </main>

  <Footer />
</Layout>

<script>
  document.getElementById("copy-address")?.addEventListener("click", async () => {
    const address = document.getElementById("donation-address")?.textContent?.trim()
    if (!address) return
    await navigator.clipboard.writeText(address)
    const btn = document.getElementById("copy-address")!
    btn.textContent = "Copied!"
    setTimeout(() => (btn.textContent = "Copy"), 1500)
  })
</script>
